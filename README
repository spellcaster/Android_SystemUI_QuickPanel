ПАКЕТ СКРИПТОВ ДЛЯ АВТОМАТИЗАЦИИ ИЗМЕНЕНИЯ SYSTEMUI ПОД LIDROID © SpellCaster

Автоматизирует инструкцию от sk0t (http://4pda.ru/forum/index.php?s=&showtopic=196047&view=findpost&p=12602328)
Поддерживает запуск не из текущей директории, а также из директорий с пробелами и нелатинскими символами
Картинки в наличии только для HDPI экранов

Требования для работы:
	* Установленная Java (JDK) http://www.oracle.com/technetwork/java/javase/downloads/index.html
Требования для установки модифицированного apk:
	* На целевом девайсе - права рута и доступ на запись в /system/app	

СОСТАВ ПАКЕТА:

	Исходные данные
		\qp_flash\ - *модифицированный* пакет замен файлов от sk0t для панели с фонариком(*1)
		\qp_noflash\ - *модифицированный* пакет замен файлов от sk0t для панели без фонарика(*1)
		\framework\ - пустая папка для файлов фреймворка

	Инструменты
		Инструменты скачиваются отдельно отсюда: https://github.com/spellcaster/Android_APKTools/archive/master.zip. Извлечь ФАЙЛЫ в директорию пакета.

		\SysUI_worker.bat - главный скрипт
		\qpid_repl.js - скрипт для замены id в qpids.smali (запускается из SysUI_worker)
		\xml_add.js - скрипт для манипуляций с xml (запускается из SysUI_worker)
	
	Разное:
		\README - этот файл
		\QuickPanelSettings.apk - приложение для настройки отображаемых индикаторов (можно также скачать с 4pda: см. по ссылке выше)

(*1) Исходные версии находятся здесь: http://4pda.ru/forum/index.php?s=&showtopic=196047&view=findpost&p=12602328. Модификация состоит в том, чтобы сделать из файлов qp_*flash\res\values-ru\strings.xml настоящие XML (добавление корневого XML узла). Наборы файлов, выложенные sk0t, без этой модификации РАБОТАТЬ ЗДЕСЬ НЕ БУДУТ.

ПРИМЕНЕНИЕ:

1) Поместить файлы пакета в отдельную директорию.

2) Скачать архив с инструментами (утилитами) отсюда: https://github.com/spellcaster/Android_APKTools/archive/master.zip, извлечь файлы в директорию пакета (т.е. файлы инструментов должны лежать рядом с файлами пакета).

3) Скачать с целевого девайса файлы /system/framework/*.apk (ВСЕ файлы с расширением apk!) (поместить в папку \framework) и /system/app/SystemUI.apk, поместить рядом с файлами Пакета.

4) Запустить SysUI_worker.bat

5) Указать режим: с фонариком или без

6) Для начала попробовать выполнить в автоматическом режиме (Step = 0). Пошаговый режим - для отладки, если возникают ошибки

7) Если всё благополучно, скрипт завершится без ошибок, а итоговое приложение будет сохранено как SystemUI_mod.apk. Если всё плохо :) - будут выданы ошибки. Желательно попробовать разобраться самим (например, если ошибка при сборке - почитать, на что именно ругается, возможно, при модификации были допущены ошибки). Если не получается - надо скопировать полный лог запуска (правая кнопка мыши - Изменить - Пометить, выделить весь текст с момента запуска скрипта, нажать Enter) и запостить в указанной теме на 4pda. Можно спросить у меня в личке, но в этом не очень много смысла, т.к. я слабо разбираюсь в природе процесса, просто автоматизировал инструкцию sk0t. Т.ч. будьте готовы, к редиректу в ту же самую тему :).
	
8) Записать из-под рекавери SystemUI_mod.apk на целевой девайс в /system/app (предварительно переименовать в SystemUI.apk). Перегрузить девайс.
Через adb это делается так:
	adb reboot recovery
	смонтировать /system через интерфейс рекавери (должно как-то выполняться командой, mount что-то там, но неохота искать)
	adb push SystemUI_mod.apk /system/app/SystemUI.apk
	adb reboot
Можно и "на горячую" - adb push SystemUI_mod.apk /system/app/SystemUI.apk при включённом и загруженном девайсе, но есть опасность глюков.

9) Если возникнут ошибки запуска com.android.statusbar, посмотреть лог (выполнить в эмуляторе терминала на целевом девайсе либо через adb shell)
	logcat
Сохранить лог в файл:
	logcat > /sdcard/err.log

10) Поставить приложение QuickPanelSettings

ПРИМ.

По умолчанию для разборки-сборки apk файлов (в т.ч. фреймворка) используется более свежая версия aapt.exe из SDK. Версия из набора apktool не умеет обрабатывать нестандартные названия ресурсов (вроде drawable-sw600dp-mdpi - выдает ошибку вида "invalid resource directory name: ...\SystemUI\res/values-sw600dp-port"), поэтому версия из SDK более всеядна. Тем не менее, если эта версия у вас выдает ошибки при разборке или сборке, можно попробовать использовать apktool версию. Для этого откройте APK_worker.bat в текстовом редакторе и раскомментируйте строчку ":: set AAPT=aapt_Custom.exe" (просто уберите символы "::").